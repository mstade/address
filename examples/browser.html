<!doctype html>
<h2>address examples</h2>
<div id="root" class="z-app"></div>

<style>
</style>

<script src="../node_modules/underscore/underscore.js"></script>
<script src="../node_modules/d3-dispatch/build/d3-dispatch.js"></script>
<script src="../node_modules/@websdk/rhumb/lib/rhumb.js"></script>
<script src="../node_modules/@websdk/nap/lib/nap.js"></script>
<script src="../lib/address.js"></script>

<script>
  var rootNode = document.getElementById('root')

  setupAddress(function(address) {
    address("/greeting/world")
      .into(rootNode)
      .get()
  })

  function greeting (req, res) {
    res(null, address.ok(view))

    function view(node) {
      node.innerHTML = '<header><h1><span>Hello </span><span class="js-name"></span></h1></header>'

      var nameElements = node.getElementsByClassName('js-name')

      nameElements[0].textContent = req.params.name || 'anonymous'
    }
  }

  function setupAddress(callback) {
    var web = nap.web()
    var routes = rhumb.create()

    web.find = function (uri) {
      return routes.match(uri)
    }

    loadResources(routes, web, nap.negotiate)

    address.location.basePath('/examples')
    addressWrapper.find = web.find
    addressWrapper.location = address.location
    addressWrapper.interpolate = address.interpolate.bind(null, web)

    callback(addressWrapper)

    function addressWrapper(r) {
      return address.address(r).web(web)
    }
  }

  function loadResources(routes, web, negotiate) {
    routes.add('/greeting/{name}', function (params) {
      return { name: 'greeting', path: '/greeting/{name}', methods: ['get'], params: params }
    })

    web.resource('greeting', '/greeting/{name}', negotiate.method({ get: negotiate.accept({ 'application/x.nap.view': greeting }) }))
  }
</script>
